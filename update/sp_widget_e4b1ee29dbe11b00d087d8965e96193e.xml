<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($location, $http, cabrillo, spModal) {
  /* widget controller */
  var c = this;
	
	// State variables and constants
  c.loaded = false;
	c.requestsLoaded = false;
	c.showDetails = true;
	c.showTaskButtons = false;
	c.submitSuccess = false;
	c.inStock = false;
	c.sso = '';
	c.comments = '';
	
	// These functions are used to open the servicenow
	// forms for the current asset, item or incident.
	
	//Open the asset record modal
	c.viewAsset = function(){
		spModal.open({
			title: "Asset",
			widget: "fd1f4ec347730200ba13a5554ee490c0",
			widgetInput:{
				table: "alm_asset",
				sys_id: c.asset.sysId,
				view: 'Default'
			},
			size: "lg"
		});
	}
	
	//Open the modal to view the information about a requested item in the Open Records tab
	c.viewRequestedItem = function(sys_id){
		spModal.open({
			title: "Requested Item",
			widget: "fd1f4ec347730200ba13a5554ee490c0",
			widgetInput:{
				table: "sc_req_item",
				sys_id: sys_id,
				view: 'Default'
			},
			size: "lg"
		});
	}
	
		//Open the modal to view the information about an incident in the Open Records tab
	c.viewIncident = function(sys_id){
		spModal.open({
			title: "Incident",
			widget: "fd1f4ec347730200ba13a5554ee490c0",
			widgetInput:{
				table: "incident",
				sys_id: sys_id,
				view: 'Default'
			},
			size: "lg"
		});
	}
	
	//Close any of the modals when you click outside of the modal
	c.closeBox = function(event){
		var target = event.target || event.srcElement;
		if (target) {
			getTodoList(c.asset.sysId);
		} 
		/*else if (target.id != "freeformTextarea" &&
							 target.id != "freeformButton" &&
							 target.id != "freeformCheckbox" &&
							 target.id != "freeformLabel") {
			//getTodoList(c.asset.sysId);
		}*/
	}
	
	//Show/hide details for the asset when you click the arrow in the top right corner
	c.toggleDetails = function(){
		c.showDetails = !c.showDetails;
	};
	
	//Show/hide the freeform slider on click of "Add Tasks" at the bottom of the screen
	c.toggleFreeformSlider = function(){
		c.showTaskButtons = !c.showTaskButtons;
	};
  
	//Get the data about the entered asset - getByIdentifier API.  This call handles the check to Atlas on the backend.
  c.getAsset = function(serial){
	    c.loadedAsset = false;
		$http({
			method: 'get',
			url: '/api/x_gege9_asset_scan/asset_scanner/GetAssetInfo/' + serial,
			headers: {
				'Content-Type': 'application/json'
			}
		}).then(function(response){
			if(response.statusText === 'OK'){
				c.asset = response.data.result;
				if (c.asset.state === 'In stock'){
					c.inStock = true;
				} else {
					c.inStock = false;
				}
				getTodoList(c.asset.sysId);
				c.error = false;
				c.loadedAsset = true;
			}else{
				c.error = true;
				if(!!response.errorMessage){
					c.errorMessage = response.errorMessage;
				}
				c.loadedAsset = true;
			}
		}, function(response){
			c.errorMessage = "Unable to find this serial number. Try entering manually.";
			c.error = true;
			c.loadedAsset = true;
		});
	};
	
	//Click the todo list item and bring up the camera to scan the stockroom
	c.scanTodo = function(todo){
		if (todo.state == '1'){
			cabrillo.camera.getBarcode().then(function(barcode) {
				if (barcode){
					c.showBinResults = true;
					c.showBinButtons = false;
					updateStockroom(c.asset.sysId, todo.sysId, barcode);
				}else{
					c.error = true;
					c.errorMessage = "Try Again";
				}
			}, function(error) {
				c.error = true;
				c.errorMessage = "Unable to scan.";
			})
		}
	};
	
	//Open Reassign modal
	c.startReassign = function(serialNo, todo){
		c.error = false;
		c.reassignError = false;
		c.reassignStarted = true;
		c.reassignTodo = todo;
		c.sso = '';
		c.comments = '';
	}
	
	//Mark the todo as completed
	c.submitReassign = function(serial, sso, comments, todo){
		$http({
			method: 'post',
			url: '/api/x_gege9_asset_scan/asset_scanner/updateAsset/' + serial,
			headers: {
				'Content-Type': 'application/json'
			},
			data: {
				sso: sso,
				comments: comments,
				todo: todo
			}
		}).then(function(response){
			if(response.statusText === 'OK'){
				c.error = false;
				c.reassignError = false;
				c.submitSuccess = true;
				c.getAsset(c.serial_no);
				if(!!response.errorMessage){
					c.errorMessage = response.errorMessage;
				}
			}
		}, function(response){
			c.reassignErrorMessage = 'Please enter a valid SSO';
			c.reassignError = true;
		});
	}
	
	c.closeReassign = function(){
		var target = event.target || event.srcElement;
		if(target.id !== 'reassignModal' && target.tagName !== 'BUTTON' || 
			 target.classList.contains('reassign-close-x')){
			c.reassignStarted = false;
		}
		if (target.id === 'reassignModal' || 
				target.classList.contains('reassign-modal-header') || 
				target.classList.contains('reassign-form-div') || 
				target.classList.contains('reassign-input') || 
				target.classList.contains('reassign-submit')) {
			c.reassignStarted = true;
		}
	}

	
	// This function is called to invoke
	// all the actions to skip a todo item 
	// from the UI.
	c.markSkipped = function(todoSysId){
		skipTodo(todoSysId);
		c.showBinResults = true;
		c.showForm = false;
		c.showBinButtons = false;
	};
	
	//Mark the todo as completed
	c.completeTodo = function(todoSysId){
		$http({
			method: 'post',
			url: '/api/x_gege9_asset_scan/asset_scanner/completeToDo/' + todoSysId,
			headers: {
				'Content-Type': 'application/json'
			}
		}).then(function(response){
			if(response.statusText === 'OK'){
				c.error = false;
				c.getAsset(c.serial_no);
			}else{
				c.error = true;
				if(!!response.errorMessage){
					c.errorMessage = response.errorMessage;
				}
			}
		}, function(response){
			c.errorMessage = "Unable to find this todo item.";
			c.error = true;
		});
	}
	
	
	//Call to get the requested item tickets related to the asset for the Open Records tab
	c.getRequestedItems = function(){
		$http({
			method: 'get',
			url: '/api/x_gege9_asset_scan/asset_scanner/getAssetRequestedItems/' + c.asset.sysId,
			headers: {
				'Content-Type': 'application/json'
			}
		}).then(function(response){
			if(response.statusText === 'OK'){
				c.requests = response.data.result;
				c.loadedRecords = true;
			} else {
				c.noRequestedItems = true;
			}
		},
		function(data){
			c.noRequestedItems = true;
		})
	}
	
	//Call to get the incident tickets related to the asset for the Open Records tab
	c.getRecentIncidents = function(){
		$http({
			method: 'get',
			url: '/api/x_gege9_asset_scan/asset_scanner/getRecentIncidents/' + c.asset.sysId,
			headers: {
				'Content-Type': 'application/json'
			}
		}).then(function(response){
			if(response.statusText === 'OK'){
				c.incidents = response.data.result;
				c.loadedRecords = true;
			} else {
				c.noIncidents = true;
			}
		},
		function(data){
			c.noIncidents = true;
		})
	}
	
	//Open modal to create a move task when the user clicks the "Move Asset" button
	c.addMoveTask = function(){
		spModal.open({
			title: 'Description of Move',
			buttons: [{label: 'Submit', primary: true}],
			input: true,
			size: 'lg'
		}).then(function(value){
			$http({
				method: 'post',
				url: '/api/x_gege9_asset_scan/asset_scanner/createFreeForm/' +
				c.asset.sysId + '/' + value + '/true/600',
				headers: {
					'Content-Type': 'application/json'
				}
			}).then(function(response){
				if(response.statusText === 'OK'){
					c.error = false;
					c.freeformDescription = '';
					getTodoList(c.asset.sysId);
					c.toggleFreeformSlider();
				}else{
					c.error = true;
					if(!!response.errorMessage){
						c.errorMessage = response.errorMessage;
					}
				}
			}, function(response){
				c.error = true;
			});
		});
	}

	//Open modal for creating a freeform task
	c.openFreeformModal = function(){
		spModal.open({
			title: 'Freeform Task',
			buttons: [{label: 'Submit', primary: true}],
			input: true,
			size: 'lg'
		}).then(function(value){
			$http({
				method: 'post',
				url: '/api/x_gege9_asset_scan/asset_scanner/createFreeForm/' +
				c.asset.sysId + '/' + value.replace("â€™", "'") + '/false/100',
				headers: {
					'Content-Type': 'application/json'
				}
			}).then(function(response){
				if(response.statusText === 'OK'){
					c.error = false;
					c.freeformDescription = '';
					getTodoList(c.asset.sysId);
					c.toggleFreeformSlider();
				}else{
					c.error = true;
					if(!!response.errorMessage){
						c.errorMessage = response.errorMessage;
					}
				}
			}, function(response){
				c.errorMessage = "Unable to find this todo list. Try entering manually.";
				c.error = true;
			});
		});
	}
	
	c.openReassignModal = function(){
		spModal.open({
			title: 'Assign Task',
			buttons: [{label: 'Submit', primary: true}],
			input: true,
			size: 'lg'
		}).then(function(value){
			$http({
				method: 'post',
				url: '/api/x_gege9_asset_scan/asset_scanner/createFreeForm/' +
				c.asset.sysId + '/' + value + '/true/900',
				headers: {
					'Content-Type': 'application/json'
				}
			}).then(function(response){
				if(response.statusText === 'OK'){
					c.error = false;
					c.freeformDescription = '';
					getTodoList(c.asset.sysId);
					c.toggleFreeformSlider();
				} else {
					c.error = true;
					if(!!response.errorMessage){
						c.errorMessage = response.errorMessage;
					}
				}
			}, function(response){
				c.error = true;
			});
		});
	}
	
	//Call to get the todo tasks related to the asset.  
	//Open todos in the To Do Items tab and closed todos for the To Do History tab
	function getTodoList(sysId){
		$http({
			method: 'get',
			url: '/api/x_gege9_asset_scan/asset_scanner/getToDoList/' + sysId,
			headers: {
				'Content-Type': 'application/json'
			}
		}).then(function(response){
			if(response.statusText === 'OK'){
				c.openTodos = response.data.result.filter(function(todo){
					todo.shortDescription.replace("Ê¼", "'");
					return todo.state == '1';
				});
				c.completedTodos = response.data.result.filter(function(todo){
					return todo.state != '1';
				});
				c.error = false;
			}else{
				c.error = true;
				if(!!response.errorMessage){
					c.errorMessage = response.errorMessage;
				}
			}
		}, function(response){
			c.errorMessage = "Unable to find this todo list. Try entering manually.";
			c.error = true;
		});
	}
	
	//Update the stockroom on the asset to the scanned stockroom 
	function updateStockroom(assetSysId, todoSysId, stockroom){
	    c.loaded = false;
		$http({
			method: 'post',
			url: '/api/x_gege9_asset_scan/asset_scanner/updateStockroom/' + assetSysId + '/' + stockroom,
			headers: {
				'Content-Type': 'application/json'
			}
		}).then(function(response){
			if(response.statusText === 'OK'){
				c.stockroomData = response.data.result;
				c.stockroomSysId = response.data.result.sysId;
				c.error = false;
				c.loaded = true;
				c.completeTodo(todoSysId);
			}else{
				c.error = true;
				if(!!response.errorMessage){
					c.errorMessage = response.errorMessage;
				}
				c.loaded = true;
			}
		}, function(response){
			c.errorMessage = "Unable to find this stockroom. Try entering manually.";
			c.error = true;
			c.loaded = true;
		});
	}
	
	//Mark todos as skipped when the user presses skip
	function skipTodo(todoSysId){
		$http({
			method: 'post',
			url: '/api/x_gege9_asset_scan/asset_scanner/skipToDo/' + todoSysId,
			headers: {
				'Content-Type': 'application/json'
			}
		}).then(function(response){
			if(response.statusText === 'OK'){
				c.error = false;
				getTodoList(c.asset.sysId);
			}else{
				c.error = true;
				if(!!response.errorMessage){
					c.errorMessage = response.errorMessage;
				}
			}
		}, function(response){
			c.errorMessage = "Unable to find this todo item.";
			c.error = true;
		});
	}
	
		//Function to be able to get a parameter from the URL
  function getParameterByName(param) {
	   return $location.search()[param];
  } 
	
  c.serial_no = getParameterByName('serial_no');
  c.getAsset(c.serial_no);
}]]></client_script>
        <controller_as>c</controller_as>
        <css>
#content {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  height: 100%;
  margin: 0 auto;
  padding: 0px 5px 70px 5px;
}

.error-message {
  z-index: 999;
  margin-top: 10px;
  position: absolute;
}

#results {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  padding: 0px 10px;
}

#asset-details {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  width: 100%;
  margin-bottom: 10px;
}

.more-details-button {
 margin: 70px 0 10px 0; 
}

#confirm {
  background-color: #00bf6f; 
}

#reject {
  background-color: red; 
}

table {
 table-layout: fixed;
}

th, td {
  word-wrap: break-word; 
}

th.-v-align--middle {
  vertical-align: middle; 
}

input {
  margin-bottom: 10px; 
}

h5 {
  color: black;
  font-weight: 600;
  margin: 5px 0px;
}

hr {
  width: 100% !important; 
  height: 1px;
  background-color: rgb(200, 200, 200);
  margin: 10px;
}

.barcode-row {
  position: fixed;
  width: 100%;
  padding: 0 10px;
  background-color: #343d47;
  color: #fff;
  z-index: 999;
}

.barcode {
	display: flex;
  justify-content: flex-start;
  flex-direction: column;
  margin-top: 10px;
}

.barcode-label {
	font-size: 12px;
}

.barcode-number {
	font-size: 26px;
  color: #fff;
}

.asset-image {
	display: flex;
  align-self: center;
  margin-bottom: 15px;
  height: 150px;
  width: 200px;
}

.details-toggle {
  margin-top: 15px;
  font-size: 18px;
  margin-bottom: 3px;
}

.barcode-row-content {
	display:flex;
  justify-content: space-between;
}

.spinner {
  text-align: center;
  padding: 24px;
}

.asset-details {
  margin-top: 0px;
  width: 100%;
  display: flex;
	flex-direction: column;
  flex: 1;
  justify-content: space-around;
}

.asset-slider {
	overflow-y: hidden;
  height: 400px;
  transition: height .25s linear;
}

.asset-slider-closed {
  height: 0px;
  overflow-y: hidden;
  transition: height .25s linear;
}

.important-asset-detail {
    font-weight: bold;
    color: red;
    
}

.asset-lists {
  width: 100%;
	display: flex;
  flex-direction: column;
  margin-bottom: 75px;  
}

.asset-lists-collapse {
	margin-top: 70px;
}

.todo-instructions {
 padding: 5px; 
}

.asset-attr {
  display: flex;
  margin: 5px 10px;
}

.capitalize {
  text-transform: capitalize;
}

.attr {
  flex: 1 1 50%; 
}

.-align--center {
  align-self: center; 
}

.-align--stretch {
  align-self: stretch;
}

.accept-reject-button {
  width: 40%;
}

button #reject {
  background-color: red; 
}

button #confirm {
  background-color: green;
}

.todo-nav {
  font-size: 12px;
  text-align: center;
}

.todo-tab {
 padding: 0; 
}

.disabled-text, .disabled-text:hover {
  color: #A9A9A9;
  background-color: #ffffff;
}

.todo-list-container {
	display: flex;
  align-items: center;
  color: #717171;
  padding-bottom: 10px;
}

.todo-scan {
  padding-left: 0;
}

.todo-list-icon-container {
  text-align: center;
}

.to-do-items {
  padding-left: 0;
}

.todo-default {
 text-align: center; 
  padding: 10px;
}

.todo-list {
  background-color: #ffffff;
}

.todo-number {
	align-self: flex-start; 
}

.todo-freeform-btn {
  height: 70px;
  background-color: #343d47;
  color: #ffffff;
}

.todo-freeform-btn-text {
	padding: 20px 0;
  font-size: 18px;
  text-align: center;
}

.todo-green-plus {
  padding: 12px 0;
  font-size: 18px;
	background-color: #343d47;
  height: 100%;
  overflow: hidden;
  color: #fff;
}

#freeformPlusIcon {
	border: 2px solid #ffffff;
  border-radius: 50%;
  padding: 5px 5px 6px 6px;
  margin-left: 15px;
  color: #fff;
}

.freeform-textarea-div {
  background-color: #343d47;
  height: 100%;
}

.create-new-task-container {
	background-color: #343d47;
  color: #ffffff;
  padding: 0;
}

.create-new-task {
  border: 1px dashed #ddd;
  border-radius: 5px;
  padding: 20px;
  margin: 15px;
  overflow: auto;
}

.create-new-task-header {
	float: left; 
}

.create-new-task-plus {
 	float: right; 
}

.checkbox {
	margin: 0 0 0 15px;
}

.todo-type {
	font-weight: bold;
}

.wordbreak {
	word-break: break-word; 
  hyphen: auto;
}

.freeform-container {
  display: flex;
  float: left;
  width: 100%;
  margin: 20px 0;
}
textarea {
 border: 1px solid #ccc; 
 border-radius: 5px 0px 0px 5px;
 height: 50px;
 resize: none;
 vertical-align: top;
 width: 79.75%;
 margin: 0 0 0 15px;
}

.has-error {
	border: 1px solid red !important; 
}

.freeform-submit {
 height: 50px;
 vertical-align: top;
 border-radius: 0px 5px 5px 0px; 
 padding: 0;
 background-color: #1ed760;
 color: #ffffff;
 margin: 0 0 0 0;
}

//Reassign Modal
#reassignModal {
  position: absolute;
  z-index: 999;
  top: 50%;
  right: 12.5%;
  width: 75%;
  background: #fff;
  border: 1px solid #ccc;
  padding: 10px;
  border-radius: 5px;
}

.reassign-modal-header {
  text-align: right;
  border-bottom: 1px solid #ccc;
  padding-bottom: 10px;
  display: flex;
  justify-content: space-between;
}

.reassign-close-x {
  font-size: 20px;
  line-height: 2;
}

.reassign-input {
  width: 100%;
  height: 34px;
  display: block;
  padding: 6px 12px;
  font-size: 14px;
  line-height: 1.42857;
  color: #555555;
  background-color: #fff;
  background-image: none;
  border: 1px solid #ccc;
  border-radius: 4px;
   -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
  box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
    -webkit-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
    -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
}

.reassign-form-div {
  padding: 10px;
}

.reassign-button-div {
  //margin-top: 40px;
  border-top: 1px solid #ccc;
}

.reassign-submit {
	margin-top: 10px; 
}

//Completed Tab
#completedTodo {
  padding-top: 5px;
}

.icon-key {
  background-color: #eeeeee; 
  max-width: 100%;
  padding: 3px 0;
  margin: 0 auto;
}

.icon-key img {
 	max-width: 50px; 
}

//Requests Tab
.no-requests {
	padding: 10px;  
}

.request-block {
	padding: 15px 20px;
}

.request-number {
	padding: 0 0 10px 0;
  font-size: 16px;
  font-weight: bold;
}

.request-title {
	font-weight: bold;
}

.requests-details {
  display: flex;
  align-items: center;
}


.checkbox {
	font-size: 16px;
}

.tab-content {
	margin-bottom: 60px;
}


// Add Tasks 
.add-tasks-row {
  position: fixed;
  width: 100%;
  background-color: #343d47;
  color: #fff;
  padding: 20px 0;
  font-size: 18px;
  text-align: center;
  z-index: 1000;
}

.task-button {
  background-color: #428bca;
  margin-top: 20px;
  padding: 30px 0;
  border-radius: 5px;
}

.slider {
	overflow-y: hidden;
  bottom:0;
  height: 100%;
  transition: height .25s linear;
}

.slider-closed {
  bottom: 40px;
  height: 70px;
  transition: height .25s linear;
}

//Home nav
.navbar {
	min-height: 0 !important;  
}

.bottom-nav {
	background-color: #fff;
  border-top: 1px solid #ccc;
  height: 40px;
}

.navbar-fixed-bottom {
	bottom: 0; 
}

.bottom-nav ul {
	padding: 0;
}

.bottom-nav li {
	padding: 0;
}

.home-menu {
  position: absolute;
  bottom: 0;
}

.navbar-nav {
  margin: 0 !important;
}

.navbar-nav li a {
 line-height: 15px !important; 
 padding: 5px 0 !important;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>scanned-information</id>
        <internal>false</internal>
        <link/>
        <name>Scanned Information</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	data.userSkills = [];
	var thisUser = gs.getUserID();
	var userSkillGR = new GlideRecord('sys_user_has_skill');
	userSkillGR.addQuery('active', true);
	userSkillGR.addQuery('user', thisUser);
	userSkillGR.query();
	while(userSkillGR.next()){
		data.userSkills.push({
			sys_id: userSkillGR.skill.toString(),
			name: userSkillGR.skill.name.toString()
		});
	}
	
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>212613005</sys_created_by>
        <sys_created_on>2018-04-18 15:36:31</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>e4b1ee29dbe11b00d087d8965e96193e</sys_id>
        <sys_mod_count>1925</sys_mod_count>
        <sys_name>Scanned Information</sys_name>
        <sys_package display_value="Asset Scanning" source="x_gege9_asset_scan">7be151dddbe55700d087d8965e9619c8</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Asset Scanning">7be151dddbe55700d087d8965e9619c8</sys_scope>
        <sys_update_name>sp_widget_e4b1ee29dbe11b00d087d8965e96193e</sys_update_name>
        <sys_updated_by>212606938</sys_updated_by>
        <sys_updated_on>2018-09-20 18:39:34</sys_updated_on>
        <template><![CDATA[<div id="content container-fluid" ng-click="c.closeReassign($event)">
  <!-- The row with barcode and toggle -->
  <div class="barcode-row center-text center-block" ng-click="c.toggleDetails()">
    <div class="barcode-row-content">
      <div class="barcode">
        <span class="barcode-label">Barcode Information</span>
        <span class="barcode-number">{{c.serial_no.toUpperCase()}}</span>
      </div>
      <a class="details-toggle">
        <i id="freeformPlusIcon" ng-class="{'glyphicon glyphicon-chevron-up': !c.showDetails, 'glyphicon glyphicon-chevron-down': c.showDetails}"></i>
      </a>
    </div>
  </div>
  
  <!-- Error Alert -->
  <div class="alert alert-danger error-message" ng-show="c.error">
    {{c.errorMessage}}
  </div>

  <!-- The row with all the information about the asset -->
  <div id="asset-details" class="asset-details" ng-class="{'asset-slider': c.showDetails, 'asset-slider-closed': !c.showDetails}">
    <div class="spinner" ng-show="!c.loadedAsset">
      <i class="fa fa-spinner fa-4x fa-pulse"></i>
    </div>
    <div id="results" ng-show="c.loadedAsset">
      <div class="col-xs-12 more-details-button">
        <img ng-if="c.image" class="img img-responsive asset-image center-block" width="65" height="65"
             ng-src="{{c.image}}" />
        <button ng-click="c.viewAsset()" class="btn btn-default btn-sm col-xs-offset-3 col-xs-6">
          VIEW ASSET RECORD
        </button>
      </div>
      <div id="asset-details">
        <div class="asset-attr"> 
          <div class="attr pull-left"><b>Legal Hold</b></div> 
          <div class="attr pull-right">
            <div ng-class="{'important-asset-detail': c.asset.legalHold == 'True'}">
              {{c.asset.legalHold}}
            </div>
          </div>
        </div>
        <div class="asset-attr"> 
          <div class="attr pull-left"><b>State</b></div> 
          <div class="attr pull-right">{{c.asset.state}}</div>
        </div>
        <div class="asset-attr"> 
          <div class="attr pull-left"><b>Sub State</b></div> 
          <div class="attr pull-right" ng-class="{'important-asset-detail': c.asset.substate == 'Pending repair'}">{{c.asset.substate}}</div>
        </div>
        <div class="asset-attr">    
          <div class="attr pull-left"><b>Bin</b></div> 
          <div class="attr pull-right" ng-hide="c.asset.stockroom == ''">{{c.asset.stockroom}}</div>
          <div class="attr pull-right" ng-show="c.asset.stockroom == ''">This asset is not assigned to a bin.</div>
        </div>
        <div class="asset-attr">    
          <div class="attr pull-left"><b>Model Category</b></div> 
          <div class="attr pull-right">{{c.asset.modelCategory}}</div>
        </div>
        <div class="asset-attr">    
          <div class="attr pull-left"><b>Model</b></div> 
          <div class="attr pull-right">{{c.asset.model}}</div>
        </div>
        <div class="asset-attr">    
          <div class="attr pull-left"><b>Acquisition Country</b></div> 
          <div class="attr pull-right" ng-hide="c.asset.acquisitionCountry == ''">{{c.asset.acquisitionCountry}}</div>
          <div class="attr pull-right" ng-show="c.asset.acquisitionCountry == ''">This asset is not assigned to a country.</div>
        </div>
        <div class="asset-attr">    
          <div class="attr pull-left"><b>Asset Type</b></div> 
          <div class="attr pull-right capitalize">{{c.asset.assetType}}</div>
        </div>
        <div class="asset-attr">    
          <div class="attr pull-left"><b>Retirement Date</b></div> 
          <div class="attr pull-right">{{c.asset.retirementDate}}</div>
        </div>
        <div class="asset-attr">    
          <div class="attr pull-left"><b>Assigned to</b></div> 
          <div class="attr pull-right" ng-hide="c.asset.assignedTo == ''">{{c.asset.assignedTo}}</div>
          <div class="attr pull-right" ng-show="c.asset.assignedTo == ''">This asset is not assigned.</div>
        </div>
        <div class="asset-attr">    
          <div class="attr pull-left"><b>Assigned to VIP</b></div> 
          <div class="attr pull-right capitalize">{{c.asset.assignedToIsVIP}}</div>
        </div>
      </div>
    </div>
  </div>
  <!-- The row with all the lists of stuffs -->
  <div class="asset-lists" ng-class="{'asset-lists-collapse': !c.showDetails}">
    <ul class="nav nav-tabs todo-nav">
      <li class="active col-xs-4 todo-tab">
        <a data-toggle="tab" href="#todo">To Do Items</a>
      </li>
      <li class="col-xs-4 todo-tab">
        <a data-toggle="tab" href="#completedTodo">To Do History</a>
      </li>
      <li class="col-xs-4 todo-tab">
        <a data-toggle="tab" href="#openRequest" ng-click="c.getRequestedItems(); c.getRecentIncidents();">Open Records</a>
      </li>
    </ul>
    <div class="tab-content">

      <!-- This is the todo tab content -->
      <div id="todo" class="tab-pane fade in active">

        <div class="col-xs-12 todo-default" ng-show="c.openTodos.length === 0">
          <h6>
            There are no to do items for this asset. Click "Add Tasks" below to add to do list tasks.
          </h6>
        </div>

        <div ng-show="c.openTodos.length > 0">
          <h6 class="todo-instructions">
            Click Scan/Done to complete the task.  Click Skip to move to the next task.
          </h6>
          <div class="todo-list" ng-repeat="todo in c.openTodos | orderBy: todo.order"
               ng-class="{'disabled disabled-text': todo.state == '3', 'disabled disabled-text-red': todo.state == '7'}">
            <div class="row todo-list-container">
              <div class="col-xs-1 todo-list-icon-container todo-number">
                <span>{{$index + 1}}.</span>
              </div>
              <div class="col-xs-7 todo-container">
                <div class="row">
                  <div class="col-xs-12 todo-type">
                    {{todo.type}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-12 wordbreak">
                    {{todo.shortDescription}}
                  </div>
                </div>
              </div>
              <div class="col-xs-2 todo-list-icon-container to-do-items">
                <button class="btn btn-primary" ng-click="c.scanTodo(todo)" 
                        ng-if="todo.typeValue != '100' && todo.typeValue != '900'">
                  SCAN
                </button>
                <!-- Modal includes Reassign Form widget -->
                <button class="btn btn-primary"
                        ng-if="todo.typeValue == '900'"
                        ng-click="c.startReassign(c.serial_no, todo.sysId)">
                  START 
                </button>
                <button class="btn btn-primary" ng-click="c.completeTodo(todo.sysId)" 
                        ng-if="todo.typeValue == '100'">
                  DONE
                </button>
              </div>
              <div class="col-xs-1 todo-list-icon-container to-do-items">
                <button class="btn btn-default" ng-click="c.markSkipped(todo.sysId)" 
                        ng-if="todo.typeValue != '500'">
                  SKIP
                </button>
              </div>
            </div> 
          </div>
        </div>
      </div>
      
      <!-- Reassign Modal-->
      <div id="reassignModal" ng-show="c.reassignStarted">
        <!-- Error Message -->
        <div class="alert alert-danger error-message" ng-show="c.reassignError">
          {{c.reassignErrorMessage}}
        </div>
        
        <div class="reassign-modal-header">
          <h4>
            Assign Asset
          </h4>
          <i class="fa fa-times reassign-close-x" aria-hidden="true"></i>
        </div>
        
         <!-- Reassign Success Message -->
        <div class="alert alert-success" ng-show="c.submitSuccess">
          Asset assigned to {{c.sso}}.
        </div>

        <form ng-hide="c.submitSuccess">
          <div class="reassign-form-div">
            <input class="reassign-input" ng-model="c.sso" type="text" placeholder="Enter user SSO">
          </div>
          <div class="reassign-form-div">
            <input class="reassign-input" ng-model="c.comments" type="text" placeholder="Comments">
          </div>
          <div class="reassign-button-div">
            <input class="btn btn-success reassign-submit pull-right" 
                   type="submit" 
                   value="Assign"
                   align="right"
                   ng-click="c.submitReassign(c.serial_no, c.sso, c.comments, c.reassignTodo)">
          </div>
        </form>
      </div>


      <!-- This is the completed todo tab content-->
      <div id="completedTodo" class="list-group tab-pane fade">
        <div ng-hide="c.completedTodos.length > 0">
          There is no task history.
        </div>
        <div ng-show="c.completedTodos.length > 0" class="row icon-key">
          <div class="text-center col-xs-3">
            Icon Key: 
          </div>
          <div class="text-center col-xs-2">
            <img src="skip.svg" /> 
          </div>
          <span class="text-center col-xs-2">Skipped Task</span>
          <div class="text-center col-xs-2">
            <img src="completed.svg" />
          </div>
          <span class="text-center col-xs-2">Completed Task</span>
        </div>

        <div class="list-group-item todo-list" ng-repeat="todo in c.completedTodos | filter:{state:'!1'} | orderBy : '-lastUpdate'"
             ng-class="{'disabled disabled-text': todo.state == '3' || todo.state == '7'}" >
          <div class="row todo-list-container">
            <div class="col-xs-2">
              <div ng-if="todo.state== '3'">
                <img src="completed.svg" />
              </div>
              <div ng-if="todo.state== '7'">
                <img src="skip.svg" />
              </div>
            </div>
            <div class="col-xs-10">
              <div class="row">
                <div class="col-xs-12">
                  {{todo.type}} - {{todo.lastUpdate | date:'medium'}}
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  {{todo.shortDescription}}
                </div>
              </div>
              <div class="row">
                <div class="col-xs-12">
                  {{todo.stockroom}}
                </div>
              </div>
            </div>
            <div class="col-xs-1 todo-list-icon-container">
              <i ng-class="{'glyphicon glyphicon-remove text-danger': todo.state !== '3' && todo.state !== '7'}"></i>
            </div>
          </div> 
        </div>
      </div>

      <!-- Open request tab content -->
      <div id="openRequest" class="col-xs-12 tab-pane fade">
        <div class="spinner" ng-hide="c.loadedRecords" ng-hide="c.noIncidents && c.noRequestedItems">
          <i class="fa fa-spinner fa-4x fa-pulse"></i>
        </div>
        <div class="col-xs-12" ng-show="c.noIncidents && c.noRequestedItems">
          No open records.
        </div>
        <div class="request-block col-xs-12" ng-repeat="request in c.requests">
          <div class="row">
            <div class="col-xs-12 request-number">
              {{request.itemNumber}}
            </div>
          </div>
          
          <!-- Requests -->
          <div class="row requests-details">
            <div class="col-xs-8">
              <div class="row">
                <span class="col-xs-6 request-title">
                  Type:
                </span>
                <span class="col-xs-6">
                  {{request.item}}
                </span>
              </div>
              <div class="row">
                <span class="col-xs-6 request-title">
                  Stage:
                </span>
                <span class="col-xs-6">
                  {{request.stage}}
                </span>
              </div>
              <div class="row">
                <span class="col-xs-6 request-title">
                  Data Reclamation:
                </span>
                <span class="col-xs-6">
                  {{request.dataReclamation}}
                </span>
              </div>
            </div>
            <div class="col-xs-4">
              <a ng-click="c.viewRequestedItem(request.sysId)" class="btn btn-default center-block">
                DETAILS
              </a>
            </div>
          </div>
        </div>
        
         <!-- Incidents -->
        <div class="request-block col-xs-12" ng-repeat="incident in c.incidents">
          <div class="row">
            <div class="col-xs-12 request-number">
              {{incident.itemNumber}}
            </div>
          </div>
          <div class="row requests-details">
            <div class="col-xs-8">
              <div class="row">
                <span class="col-xs-6 request-title">
                  State:
                </span>
                <span class="col-xs-6">
                  {{incident.state}}
                </span>
              </div>
              <div class="row">
                <span class="col-xs-6 request-title">
                  Description:
                </span>
                <span class="col-xs-6">
                  {{incident.description}}
                </span>
              </div>
            </div>
            <div class="col-xs-4">
              <a ng-click="c.viewIncident(incident.sysId)" class="btn btn-default center-block">
                DETAILS
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- New Task Section -->
  <div class="add-tasks-row" ng-class="{slider: c.showTaskButtons, 'slider-closed': !c.showTaskButtons}">
    <div ng-click="c.toggleFreeformSlider()">
      ADD TASKS
   		 <i id="freeformPlusIcon" ng-class="{'glyphicon glyphicon-chevron-up': !c.showTaskButtons, 'glyphicon glyphicon-chevron-down': c.showTaskButtons}"></i>
    </div>
    <div class="container-fluid">
      <div class="col-xs-4 col-xs-offset-1 task-button" ng-click="c.addMoveTask()">
        MOVE ASSET
      </div>
      <div class="col-xs-4 col-xs-offset-2 task-button" ng-click="c.openFreeformModal()">
        FREEFORM
      </div>
    </div>
    <div class="container-fluid" ng-show="c.inStock">
      <div class="col-xs-4 col-xs-offset-1 task-button" ng-click="c.openReassignModal()">
        ASSIGN
      </div>
    </div>
  </div>
  
  <!-- Home nav -->
  <div class="navbar navbar-fixed-bottom bottom-nav">
    <div class="container-fluid">
      <ul class="nav navbar-nav col-xs-12">
        <li class="text-center center-block col-xs-12">
          <a href="/asset_scan"><i class="glyphicon glyphicon-home"></i>
            <p>
              Home
            </p>
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>
]]></template>
    </sp_widget>
</record_update>
